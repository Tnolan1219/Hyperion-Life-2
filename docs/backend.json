{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Base 44 platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.  This corresponds to the Firebase Auth UID.",
          "format": "uuid"
        },
        "profile": {
          "type": "string",
          "description": "References the UserProfile entity. (Relationship: User 1:1 UserProfile)"
        },
        "preferences": {
          "type": "string",
          "description": "References the UserPreferences entity. (Relationship: User 1:1 UserPreferences)"
        },
        "persona": {
          "type": "string",
          "description": "Summary of the user's AI persona, generated and updated by AI models."
        }
      },
      "required": [
        "id",
        "profile",
        "preferences"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Stores profile information for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "age": {
          "type": "number",
          "description": "User's age."
        },
        "location": {
          "type": "string",
          "description": "User's location."
        },
        "income": {
          "type": "number",
          "description": "User's annual income."
        },
        "careerStage": {
          "type": "string",
          "description": "User's career stage."
        }
      },
      "required": [
        "id"
      ]
    },
    "UserPreferences": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserPreferences",
      "type": "object",
      "description": "Stores user-specific preferences for the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserPreferences entity."
        },
        "riskTolerance": {
          "type": "string",
          "description": "User's risk tolerance level."
        },
        "darkMode": {
          "type": "boolean",
          "description": "Whether dark mode is enabled for the user."
        },
        "reducedMotion": {
          "type": "boolean",
          "description": "Whether reduced motion is enabled for the user."
        },
        "notificationOptIn": {
          "type": "boolean",
          "description": "Whether the user has opted into notifications."
        }
      },
      "required": [
        "id"
      ]
    },
    "Asset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Asset",
      "type": "object",
      "description": "Represents an asset owned by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the asset."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Asset)"
        },
        "type": {
          "type": "string",
          "description": "Type of asset (e.g., bank, investment, realEstate, crypto)."
        },
        "name": {
          "type": "string",
          "description": "Name of the asset."
        },
        "institution": {
          "type": "string",
          "description": "Institution holding the asset."
        },
        "value": {
          "type": "number",
          "description": "Current value of the asset."
        },
        "currency": {
          "type": "string",
          "description": "Currency of the asset."
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the asset.",
          "items": {
            "type": "string"
          }
        },
        "details": {
          "type": "string",
          "description": "Account ID, interest rate, allocation, and notes about the asset."
        },
        "updatedAt": {
          "type": "string",
          "description": "Last update date and time of the asset.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Creation date and time of the asset.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "name",
        "value",
        "currency"
      ]
    },
    "Debt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Debt",
      "type": "object",
      "description": "Represents a debt owed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the debt."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Debt)"
        },
        "type": {
          "type": "string",
          "description": "Type of debt (e.g., loan, creditCard, mortgage, studentLoan)."
        },
        "name": {
          "type": "string",
          "description": "Name of the debt."
        },
        "lender": {
          "type": "string",
          "description": "Lender for the debt."
        },
        "balance": {
          "type": "number",
          "description": "Current balance of the debt."
        },
        "apr": {
          "type": "number",
          "description": "Annual percentage rate for the debt."
        },
        "minimumPayment": {
          "type": "number",
          "description": "Minimum payment due for the debt."
        },
        "dueDate": {
          "type": "string",
          "description": "Due date for the debt payment.",
          "format": "date-time"
        },
        "strategyMeta": {
          "type": "string",
          "description": "Snowball rank and avalanche rank for debt payoff strategies."
        },
        "updatedAt": {
          "type": "string",
          "description": "Last update date and time of the debt.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Creation date and time of the debt.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "name",
        "lender",
        "balance",
        "apr",
        "minimumPayment",
        "dueDate"
      ]
    },
    "Goal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Goal",
      "type": "object",
      "description": "Represents a financial goal set by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the goal."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Goal)"
        },
        "goalType": {
          "type": "string",
          "description": "Type of goal (e.g., emergencyFund, houseDownPayment, retirement)."
        },
        "targetAmount": {
          "type": "number",
          "description": "Target amount for the goal."
        },
        "targetDate": {
          "type": "string",
          "description": "Target date for achieving the goal.",
          "format": "date-time"
        },
        "progressAmount": {
          "type": "number",
          "description": "Current progress towards the goal."
        },
        "milestones": {
          "type": "array",
          "description": "Milestones associated with the goal.",
          "items": {
            "type": "string"
          }
        },
        "updatedAt": {
          "type": "string",
          "description": "Last update date and time of the goal.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Creation date and time of the goal.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "goalType",
        "targetAmount",
        "targetDate",
        "progressAmount"
      ]
    },
    "Tip": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tip",
      "type": "object",
      "description": "Represents a financial tip.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tip."
        },
        "title": {
          "type": "string",
          "description": "Title of the tip."
        },
        "body": {
          "type": "string",
          "description": "Body of the tip."
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the tip.",
          "items": {
            "type": "string"
          }
        },
        "source": {
          "type": "string",
          "description": "Source of the tip."
        },
        "priority": {
          "type": "number",
          "description": "Priority of the tip."
        },
        "publishedAt": {
          "type": "string",
          "description": "Date and time the tip was published.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "body",
        "source",
        "priority",
        "publishedAt"
      ]
    },
    "Link": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Link",
      "type": "object",
      "description": "Represents a link to an external resource.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the link."
        },
        "title": {
          "type": "string",
          "description": "Title of the link."
        },
        "url": {
          "type": "string",
          "description": "URL of the link.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "Category of the link (e.g., site, resource)."
        },
        "priority": {
          "type": "number",
          "description": "Priority of the link."
        },
        "publishedAt": {
          "type": "string",
          "description": "Date and time the link was published.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "url",
        "category",
        "priority",
        "publishedAt"
      ]
    },
    "NewsCache": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "NewsCache",
      "type": "object",
      "description": "Represents a cached news article.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the news article (hash of the URL)."
        },
        "title": {
          "type": "string",
          "description": "Title of the news article."
        },
        "url": {
          "type": "string",
          "description": "URL of the news article.",
          "format": "uri"
        },
        "source": {
          "type": "string",
          "description": "Source of the news article."
        },
        "publishedAt": {
          "type": "string",
          "description": "Date and time the news article was published.",
          "format": "date-time"
        },
        "summary": {
          "type": "string",
          "description": "Summary of the news article."
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the news article.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "url",
        "source",
        "publishedAt",
        "summary"
      ]
    },
    "Advice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Advice",
      "type": "object",
      "description": "Represents AI-generated financial advice.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the advice."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Advice)"
        },
        "adviceType": {
          "type": "string",
          "description": "Type of advice (e.g., coaching, scenario, nudge)."
        },
        "prompt": {
          "type": "string",
          "description": "Prompt used to generate the advice."
        },
        "response": {
          "type": "string",
          "description": "AI-generated response."
        },
        "modelMeta": {
          "type": "string",
          "description": "Metadata about the AI model used to generate the advice."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time the advice was generated.",
          "format": "date-time"
        },
        "feedback": {
          "type": "string",
          "description": "User feedback on the advice (rating and notes)."
        }
      },
      "required": [
        "id",
        "userId",
        "adviceType",
        "prompt",
        "response",
        "modelMeta",
        "createdAt"
      ]
    },
    "AiSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiSession",
      "type": "object",
      "description": "Represents an AI coaching session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI session."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N AiSession)"
        },
        "context": {
          "type": "string",
          "description": "Contextual information for the session (goals, risk tolerance, asset summary, debt summary)."
        },
        "messages": {
          "type": "array",
          "description": "Messages exchanged during the session.",
          "items": {
            "type": "string"
          }
        },
        "modelMeta": {
          "type": "string",
          "description": "Metadata about the AI model used during the session."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time the session was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "context",
        "messages",
        "modelMeta",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data.  The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/profiles/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "profileId",
              "description": "The id of the user profile document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/preferences/{preferencesId}",
        "definition": {
          "entityName": "UserPreferences",
          "schema": {
            "$ref": "#/backend/entities/UserPreferences"
          },
          "description": "Stores user preferences. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "preferencesId",
              "description": "The id of the user preferences document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/assets/{assetId}",
        "definition": {
          "entityName": "Asset",
          "schema": {
            "$ref": "#/backend/entities/Asset"
          },
          "description": "Stores assets owned by the user. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "assetId",
              "description": "The unique identifier of the asset."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/debts/{debtId}",
        "definition": {
          "entityName": "Debt",
          "schema": {
            "$ref": "#/backend/entities/Debt"
          },
          "description": "Stores debts owed by the user. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "debtId",
              "description": "The unique identifier of the debt."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/goals/{goalId}",
        "definition": {
          "entityName": "Goal",
          "schema": {
            "$ref": "#/backend/entities/Goal"
          },
          "description": "Stores financial goals set by the user. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "goalId",
              "description": "The unique identifier of the goal."
            }
          ]
        }
      },
      {
        "path": "/tips/{tipId}",
        "definition": {
          "entityName": "Tip",
          "schema": {
            "$ref": "#/backend/entities/Tip"
          },
          "description": "Stores financial tips.",
          "params": [
            {
              "name": "tipId",
              "description": "The unique identifier of the financial tip."
            }
          ]
        }
      },
      {
        "path": "/links/{linkId}",
        "definition": {
          "entityName": "Link",
          "schema": {
            "$ref": "#/backend/entities/Link"
          },
          "description": "Stores links to external resources.",
          "params": [
            {
              "name": "linkId",
              "description": "The unique identifier of the link."
            }
          ]
        }
      },
      {
        "path": "/newsCache/{newsCacheId}",
        "definition": {
          "entityName": "NewsCache",
          "schema": {
            "$ref": "#/backend/entities/NewsCache"
          },
          "description": "Stores cached news articles.",
          "params": [
            {
              "name": "newsCacheId",
              "description": "The unique identifier of the news cache article (hash of the URL)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/advice/{adviceId}",
        "definition": {
          "entityName": "Advice",
          "schema": {
            "$ref": "#/backend/entities/Advice"
          },
          "description": "Stores AI-generated financial advice for the user. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "adviceId",
              "description": "The unique identifier of the advice."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/aiSessions/{aiSessionId}",
        "definition": {
          "entityName": "AiSession",
          "schema": {
            "$ref": "#/backend/entities/AiSession"
          },
          "description": "Stores AI coaching sessions for the user. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "aiSessionId",
              "description": "The unique identifier of the AI session."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure Authorization Independence, Clarity of Intent, and support secure list operations (QAPs). User-owned data is stored in hierarchical paths under the `/users/{userId}` collection, ensuring clear ownership.  This eliminates the need for `get()` calls in security rules to check ownership, enabling atomic operations. Tips, Links, and NewsCache are stored in root-level collections, allowing global read access without compromising user data.\n\nAuthorization Independence is achieved by avoiding hierarchical authorization dependencies. For instance, assets, debts, goals, advice and AI sessions are stored under the user's document, making it easy to check ownership directly in the security rules without needing to access parent documents.\n\nQAPs are supported through structural segregation. Publicly accessible data (tips, links, newsCache) is stored separately from user-specific data, enabling secure `list` operations. User-specific data (assets, debts, goals, advice, aiSessions) benefits from path-based ownership, further simplifying and securing `list` operations."
  }
}